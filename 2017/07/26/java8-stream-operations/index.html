<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Java,Java8,函数式编程," />










<meta name="description" content="Stream API就可以在背后进行多种优化。此外，使用内部迭代的话， Stream API可以决定并行运行代码。Stream API支持的许多操作。支持复杂的数据查询，如筛选、切片、映射、查找、匹配和归约。Stream API还支持一些特殊的流：数值流、来自文件和数组等多种来源的流，无限流。">
<meta name="keywords" content="Java,Java8,函数式编程">
<meta property="og:type" content="article">
<meta property="og:title" content="Java8-使用流">
<meta property="og:url" content="http://yoursite.com/2017/07/26/java8-stream-operations/index.html">
<meta property="og:site_name" content="darcy he">
<meta property="og:description" content="Stream API就可以在背后进行多种优化。此外，使用内部迭代的话， Stream API可以决定并行运行代码。Stream API支持的许多操作。支持复杂的数据查询，如筛选、切片、映射、查找、匹配和归约。Stream API还支持一些特殊的流：数值流、来自文件和数组等多种来源的流，无限流。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://static.zybuluo.com/csqiang1992/jm2h4gn8u59znmoo4lxgamsd/java8-intermediate-terminal-ops-2.png">
<meta property="og:updated_time" content="2017-07-26T08:37:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java8-使用流">
<meta name="twitter:description" content="Stream API就可以在背后进行多种优化。此外，使用内部迭代的话， Stream API可以决定并行运行代码。Stream API支持的许多操作。支持复杂的数据查询，如筛选、切片、映射、查找、匹配和归约。Stream API还支持一些特殊的流：数值流、来自文件和数组等多种来源的流，无限流。">
<meta name="twitter:image" content="http://static.zybuluo.com/csqiang1992/jm2h4gn8u59znmoo4lxgamsd/java8-intermediate-terminal-ops-2.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/07/26/java8-stream-operations/"/>





  <title>Java8-使用流 | darcy he</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">darcy he</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">求知 孤勇 温柔</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/26/java8-stream-operations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="darcy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/self.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="darcy he">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Java8-使用流</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-26T16:19:40+08:00">
                2017-07-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/07/26/java8-stream-operations/" class="leancloud_visitors" data-flag-title="Java8-使用流">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>Stream API就可以在背后进行多种优化。此外，使用内部迭代的话， Stream API可以决定并行运行代码。Stream API支持的许多操作。支持复杂的数据查询，如筛选、切片、映射、查找、匹配和归约。Stream API还支持一些特殊的流：数值流、来自文件和数组等多种来源的流，无限流。</p>
</blockquote>
<a id="more"></a>
<hr>
<h2 id="筛选和切片"><a href="#筛选和切片" class="headerlink" title="筛选和切片"></a>筛选和切片</h2><h3 id="谓词筛选"><a href="#谓词筛选" class="headerlink" title="谓词筛选"></a>谓词筛选</h3><ul>
<li>Streams接口支持filter方法。该操作会接受一个谓词（<strong>() -&gt; boolean</strong>）作为参数，并返回一个包括所有<strong>符合谓词的元素的流</strong>。</li>
</ul>
<p><strong>demo-1</strong></p>
<ul>
<li>创建一张素食菜单</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Filtering with predicate</span></span><br><span class="line">List&lt;Dish&gt; vegetarianMenu = menu.stream()</span><br><span class="line">        <span class="comment">// Stream&lt;T&gt; filter(Predicate&lt;? super T&gt; predicate);</span></span><br><span class="line">        .filter(Dish::isVegetarian)</span><br><span class="line">        .collect(toList());</span><br></pre></td></tr></table></figure>
<h3 id="筛选各异的元素"><a href="#筛选各异的元素" class="headerlink" title="筛选各异的元素"></a>筛选各异的元素</h3><ul>
<li>distinct的方法，它会返回一个元素各异（根据流所生成元素的hashCode和equals方法实现）的流。</li>
</ul>
<p><strong>demo-1</strong></p>
<ul>
<li>筛选出列表中所有的偶数，并确保没有重复</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Filtering unique elements</span></span><br><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">numbers.stream()</span><br><span class="line">       .filter(i -&gt; i % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">       .distinct()</span><br><span class="line">       .forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<h3 id="截断流"><a href="#截断流" class="headerlink" title="截断流"></a>截断流</h3><ul>
<li>流支持limit(n)方法，该方法会返回一个不超过给定长度的流。</li>
<li>limit也可以用在无序流上，比如源是一个Set。这种情况下， limit的结果不会以任何顺序排列。</li>
</ul>
<p><strong>demo-1</strong></p>
<ul>
<li>选出热量超过300卡路里的头三道菜</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Truncating a stream</span></span><br><span class="line">List&lt;Dish&gt; dishesLimit3 =</span><br><span class="line">    menu.stream()</span><br><span class="line">        .filter(d -&gt; d.getCalories() &gt; <span class="number">300</span>)</span><br><span class="line">        .limit(<span class="number">3</span>) <span class="comment">// 选出了符合谓词的头三个元素，然后就立即返回了结果</span></span><br><span class="line">        .collect(toList());</span><br></pre></td></tr></table></figure>
<h3 id="跳过元素"><a href="#跳过元素" class="headerlink" title="跳过元素"></a>跳过元素</h3><ul>
<li>流还支持skip(n)方法，返回一个扔掉了前n个元素的流。如果流中元素不足n个，则返回一个空流。</li>
</ul>
<p><strong>demo-1</strong></p>
<ul>
<li>跳过超过300卡路里的头两道菜，并返回剩下的</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Skipping elements</span></span><br><span class="line">List&lt;Dish&gt; dishesSkip2 =</span><br><span class="line">    menu.stream()</span><br><span class="line">        .filter(d -&gt; d.getCalories() &gt; <span class="number">300</span>)</span><br><span class="line">        .skip(<span class="number">2</span>)</span><br><span class="line">        .collect(toList());</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h2><h3 id="对流中每一个元素应用函数"><a href="#对流中每一个元素应用函数" class="headerlink" title="对流中每一个元素应用函数"></a>对流中每一个元素应用函数</h3><ul>
<li>流支持map方法，它会接受一个函数作为参数。<strong>这个函数会被应用到每个元素上，并将其映射成一个新的Target类型的元素</strong>, 返回的是映射后的元素组成的流: <code>Stream&lt;Target&gt;</code></li>
</ul>
<p><strong>demo-1</strong></p>
<ul>
<li>提取流中菜肴的名称</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// map</span></span><br><span class="line">List&lt;String&gt; dishNames = menu.stream()</span><br><span class="line">            <span class="comment">// &lt;R&gt; Stream&lt;R&gt; map(Function&lt;? super T, ? extends R&gt; mapper);</span></span><br><span class="line">            .map(Dish::getName) <span class="comment">// map方法输出的流的类型就是Stream&lt;String&gt;</span></span><br><span class="line">            .collect(toList());</span><br></pre></td></tr></table></figure>
<p><strong>demo-2</strong></p>
<ul>
<li>单词列表每个单词的长度</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// map</span></span><br><span class="line">List&lt;String&gt; words = Arrays.asList(<span class="string">"Hello"</span>, <span class="string">"World"</span>);</span><br><span class="line">List&lt;Integer&gt; wordLengths = words.stream()</span><br><span class="line">                                 .map(String::length) <span class="comment">// Stream&lt;Integer&gt;</span></span><br><span class="line">                                 .collect(toList());</span><br></pre></td></tr></table></figure>
<h3 id="流的扁平化"><a href="#流的扁平化" class="headerlink" title="流的扁平化"></a>流的扁平化</h3><ul>
<li>Arrays.stream()的方法可以接受一个数组并产生一个其中元素的流</li>
<li>使用<code>flatMap</code>方法的效果是，各个<strong>数组</strong>并不是分别映射成一个流，而是映射成流的内容。所有使用<code>map(Arrays::stream)</code>时生成的单个流都被合并起来，即扁平化为一个流。（<strong>数组被映射成的流被合并起来</strong>）</li>
<li><strong><code>flatmap</code>方法让你把一个流中的每个值都换成另一个流，然后把所有的流连接起来成为一个流</strong>。</li>
</ul>
<p><strong>Problem-1</strong></p>
<ul>
<li>对于一张单词表 ， 如何返回一张列表，列出里面各不相同的字符呢？例如，给定单词列表[“Hello”,”World”]，你想要返回列表[“H”,”e”,”l”, “o”,”W”,”r”,”d”]</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// error solutions.</span></span><br><span class="line"><span class="comment">// 思路1</span></span><br><span class="line">List&lt;String[]&gt; list = words.stream()</span><br><span class="line">                .map(str -&gt; str.split(<span class="string">"\\s+"</span>))　<span class="comment">// 返回的流类型Stream&lt;String[]&gt;, 而我们想要的是Stream&lt;Stream&gt;</span></span><br><span class="line">                .distinct()</span><br><span class="line">                .collect(toList()); <span class="comment">// 注意此时的返回值类型．</span></span><br><span class="line">                </span><br><span class="line"><span class="comment">// 思路2</span></span><br><span class="line"> List&lt;Stream&lt;String&gt;&gt; streamList = words.stream()</span><br><span class="line">                .map(str -&gt; str.split(<span class="string">"\\s+"</span>))　<span class="comment">// Stream&lt;String[]&gt;</span></span><br><span class="line">                .map(Arrays::stream) <span class="comment">// Stream&lt;Stream&lt;String&gt;&gt;</span></span><br><span class="line">                .distinct()</span><br><span class="line">                .collect(toList()); <span class="comment">// Stream-&gt;List，注意返回值．</span></span><br><span class="line">                </span><br><span class="line"><span class="comment">// 只有以下两个是正确的．                </span></span><br><span class="line"><span class="comment">// 思路3</span></span><br><span class="line"><span class="comment">// flatMap</span></span><br><span class="line">List&lt;String&gt; stringList = words.stream()</span><br><span class="line">                .flatMap(str -&gt; Arrays.stream(str.split(<span class="string">"\\s+"</span>))) <span class="comment">// str -&gt; Stream&lt;String[]&gt; -&gt; Stream&lt;Stream&lt;String&gt;&gt; -&gt; Stream&lt;String&gt;</span></span><br><span class="line">                .distinct()</span><br><span class="line">                .collect(toList());\</span><br><span class="line"></span><br><span class="line"><span class="comment">// 两个步骤分拆</span></span><br><span class="line">List&lt;String&gt; uniqueCharacters = words.stream()</span><br><span class="line">            .map(w -&gt; w.split(<span class="string">""</span>)) <span class="comment">// Stream&lt;String[]&gt;</span></span><br><span class="line">            .flatMap(Arrays::stream) <span class="comment">// Stream&lt;String&gt;</span></span><br><span class="line">            .distinct()</span><br><span class="line">            .collect(Collectors.toList());</span><br></pre></td></tr></table></figure>
<p><strong>Problem-2</strong></p>
<ul>
<li>给定一个数字列表，如何返回一个由每个数的平方构成的列表呢？例如，给定[1, 2, 3, 4,5]，应该返回[1, 4, 9, 16, 25]</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">List&lt;Integer&gt; squares =numbers.stream()</span><br><span class="line">            .map(n -&gt; n * n)</span><br><span class="line">            .collect(toList());</span><br></pre></td></tr></table></figure>
<p><strong>Problem-3</strong></p>
<ul>
<li>给定两个数字列表，如何返回所有的数对呢？例如，给定列表[1, 2, 3]和列表[3, 4]，应该返回[(1, 3), (1, 4), (2, 3), (2, 4), (3, 3), (3, 4)]</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; numbers11 = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">List&lt;Integer&gt; numbers22 = Arrays.asList(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">List&lt;<span class="keyword">int</span>[]&gt; pairs1 =  numbers1.stream()</span><br><span class="line">            .flatMap(i -&gt; numbers2.stream()</span><br><span class="line">                            .map(j -&gt; <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;i, j&#125;)) <span class="comment">// // 每个i都映射为一个Stream&lt;int[]&gt;, 需要将这多个Stream&lt;int[]&gt;合并为一个Stream&lt;int[]&gt;</span></span><br><span class="line">            .collect(toList());</span><br></pre></td></tr></table></figure>
<p><strong>Problem-4</strong></p>
<ul>
<li>同上, 但是只返回总和能被3整除的数对</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flatMap</span></span><br><span class="line">List&lt;Integer&gt; numbers1 = Arrays.asList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line">List&lt;Integer&gt; numbers2 = Arrays.asList(<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>);</span><br><span class="line">List&lt;<span class="keyword">int</span>[]&gt; pairs = numbers1.stream()</span><br><span class="line">            .flatMap((Integer i) -&gt; numbers2.stream()</span><br><span class="line">                            .map((Integer j) -&gt; <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;i, j&#125;))</span><br><span class="line">            .filter(pair -&gt; (pair[<span class="number">0</span>] + pair[<span class="number">1</span>]) % <span class="number">3</span> == <span class="number">0</span>) <span class="comment">// 对生成的Stream&lt;int[]&gt;进行过滤，得到的还是Stream&lt;int[]&gt;流</span></span><br><span class="line">            .collect(toList());</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="查找和匹配"><a href="#查找和匹配" class="headerlink" title="查找和匹配"></a>查找和匹配</h2><ul>
<li>数据集中的某些元素是否匹配一个给定的属性。 Stream API通过allMatch、 anyMatch、 noneMatch、 findFirst和findAny方法提供了这样的工具。</li>
<li>anyMatch、 allMatch和noneMatch这三个操作都用到了<strong>短路特性</strong>．</li>
<li>对于流而言，某些操作 （例如allMatch、anyMatch、noneMatch、findFirst和findAny）不用处理整个流就能得到结果。只要找到一个元素，就可以有结果了。同样，limit也是一个短路操作：它只需要创建一个给定大小的流，而用不着处理流中所有的元素。</li>
<li><code>xxxMatch</code> 需要传入一个Predicate谓词．</li>
</ul>
<h3 id="检查谓词是否至少匹配一个元素"><a href="#检查谓词是否至少匹配一个元素" class="headerlink" title="检查谓词是否至少匹配一个元素"></a>检查谓词是否至少匹配一个元素</h3><ul>
<li><code>anyMatch</code>方法会看“流中是否有一个元素能匹配给定的谓词”</li>
<li><code>anyMatch</code>方法返回一个boolean，因此是一个<strong>终端操作</strong>。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(menu.stream().anyMatch(Dish::isVegetarian))&#123;</span><br><span class="line">    System.out.println(<span class="string">"The menu is (somewhat) vegetarian friendly!!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="检查谓词是否匹配所有元素"><a href="#检查谓词是否匹配所有元素" class="headerlink" title="检查谓词是否匹配所有元素"></a>检查谓词是否匹配所有元素</h3><ul>
<li><code>allMatch</code>会看流中的元素是否都能匹配给定的谓词。</li>
<li><code>noneMatch</code>可以确保流中没有任何元素与给定的谓词匹配。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// allMatch</span></span><br><span class="line"><span class="keyword">boolean</span> isHealthy = menu.stream()</span><br><span class="line">        .allMatch(d -&gt; d.getCalories() &lt; <span class="number">1000</span>); <span class="comment">// 所有的Dish是否都是 &lt; 1000 calories</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">// noneMatch</span></span><br><span class="line"><span class="keyword">boolean</span> isHealthy = menu.stream()</span><br><span class="line">        .noneMatch(d -&gt; d.getCalories() &gt;= <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<h3 id="查找元素"><a href="#查找元素" class="headerlink" title="查找元素"></a>查找元素</h3><ul>
<li><code>findAny</code>方法将返回当前流中的任意元素。流水线将在后台进行优化使其只需走一遍，并<strong>在利用短路找到结果时立即结束</strong>。</li>
<li>findXXX()方法并不需要传入一个Predicate谓词．</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Dish&gt; dish = menu.stream()</span><br><span class="line">                .filter(Dish::isVegetarian)</span><br><span class="line">                .findAny(); <span class="comment">// findAny可能什么元素都没找到。所以返回的是Optional&lt;Dish&gt;</span></span><br><span class="line">dish.ifPresent(d -&gt; System.out.println(d.getName()));</span><br></pre></td></tr></table></figure>
<h3 id="Optional简介"><a href="#Optional简介" class="headerlink" title="Optional简介"></a>Optional简介</h3><ul>
<li>Optional<t>类（java.util.Optional）是一个容器类，代表一个值存在或不存在。</t></li>
<li>Optional里面几种可以显式地检查值是否存在或处理值不存在的情形<ul>
<li><code>isPresent()</code>将在Optional包含值的时候返回true, 否则返回false。</li>
<li><code>ifPresent(Consumer&lt;T&gt; block)</code>会在值存在的时候执行给定的代码块。Consumer函数式接口；它让你传递一个接收T类型参数，并返回void的Lambda表达式。</li>
<li><code>T get()</code>会在值存在时返回值，否则抛出一个NoSuchElement异常。</li>
<li><code>T orElse(T other)</code>会在值存在时返回值，否则返回一个默认值。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">menu.stream()</span><br><span class="line">    .filter(Dish::isVegetarian)</span><br><span class="line">    .findAny()</span><br><span class="line">    .ifPresent(d -&gt; System.out.println(d.getName());</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="查找第一个元素"><a href="#查找第一个元素" class="headerlink" title="查找第一个元素"></a>查找第一个元素</h3><ul>
<li><code>findFirst</code> 方法找到流中的第一个元素．工作方式类似于findAny</li>
<li>何时使用<code>findFirst</code>和<code>findAny</code><ul>
<li>为什么会同时有findFirst和findAny呢？因为并行的限制。<code>findFirst</code>找到第一个元素在并行上限制更多。<strong>如果不关心返回的元素是哪个，请使用findAny，因为它在使用并行流时限制较少</strong>。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 找到第一个能被3整除的数</span></span><br><span class="line">List&lt;Integer&gt; someNumbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">Optional&lt;Integer&gt; firstSquareDivisibleByThree = someNumbers.stream()</span><br><span class="line">        .map(x -&gt; x * x)</span><br><span class="line">        .filter(x -&gt; x % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">        .findFirst(); <span class="comment">// 同样返回的是Optional&lt;Integer&gt;, 因为可能什么都找不到, 9</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="归约"><a href="#归约" class="headerlink" title="归约"></a>归约</h2><ul>
<li>归约操作（将流归约成一个值）</li>
</ul>
<h3 id="元素求和"><a href="#元素求和" class="headerlink" title="元素求和"></a>元素求和</h3><ul>
<li><p>reduce接受两个参数：</p>
<ul>
<li>一个初始值，这里是0；</li>
<li>一个 <code>BinaryOperator&lt;T&gt;</code> (<code>(T, T) -&gt; T</code>)来将两个元素结合起来产生一个新值，这里我们用的是Lambda  <code>(a, b) -&gt; a + b</code>;  Lambda反复结合每个元素，直到流被归约成一个值。</li>
</ul>
</li>
<li><p>考虑流中没有任何元素的情况。reduce操作无法返回其和，因为它没有初始值。这就是为什么结果被包裹在一个Optional对象里，以表明和可能不存在。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for-each方式</span></span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x : numbers) &#123;</span><br><span class="line">    sum += x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// reduce方式求和</span></span><br><span class="line"><span class="keyword">int</span> sum = numbers.stream()</span><br><span class="line">    .reduce(<span class="number">0</span>, (a, b) -&gt; a + b);</span><br><span class="line"></span><br><span class="line"><span class="comment">// reduce方式求积</span></span><br><span class="line"><span class="keyword">int</span> product = numbers.stream()</span><br><span class="line">    .reduce(<span class="number">1</span>, (a, b) -&gt; a * b);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Integer类有了一个静态的sum方法来对两个数求和</span></span><br><span class="line"><span class="keyword">int</span> sum = numbers.stream().reduce(<span class="number">0</span>, Integer::sum);</span><br><span class="line"></span><br><span class="line"><span class="comment">// reduce还有一个重载的变体，它不接受初始值，但是会返回一个Optional对象</span></span><br><span class="line">Optional&lt;Integer&gt; sum = numbers.stream().reduce((a, b) -&gt; (a + b));</span><br></pre></td></tr></table></figure>
<h3 id="最大值和最小值"><a href="#最大值和最小值" class="headerlink" title="最大值和最小值"></a>最大值和最小值</h3><ul>
<li>reduce接受两个参数：<ul>
<li>一个初始值</li>
<li>一个Lambda来把两个流元素结合起来并产生一个新值</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Optional&lt;T&gt; reduce(BinaryOperator&lt;T&gt; accumulator);</span></span><br><span class="line">Optional&lt;Integer&gt; max = numbers.stream().reduce(Integer::max); <span class="comment">// 需要一个BinaryOperator, 接收两个值，返回一个值．</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要一个最大值</span></span><br><span class="line"><span class="comment">// 可以使用Lambda (x, y) -&gt; x &lt; y ? x : y而不是Integer::min</span></span><br><span class="line">Optional&lt;Integer&gt; min = numbers.stream().reduce(Integer::min);　<span class="comment">// 同上．</span></span><br></pre></td></tr></table></figure>
<p><strong>demo-1</strong></p>
<ul>
<li>用map和reduce方法数一数流中有多少个元素</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = menu.stream()</span><br><span class="line">    .map(d -&gt; <span class="number">1</span>)</span><br><span class="line">    .reduce(<span class="number">0</span>, (a, b) -&gt; a + b);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 内置的count()方法</span></span><br><span class="line"><span class="keyword">long</span> count = menu.stream().count();</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="中间操作和终端操作汇总"><a href="#中间操作和终端操作汇总" class="headerlink" title="中间操作和终端操作汇总"></a>中间操作和终端操作汇总</h2><p><img src="http://static.zybuluo.com/csqiang1992/jm2h4gn8u59znmoo4lxgamsd/java8-intermediate-terminal-ops-2.png" alt="java8-intermediate-terminal-ops-2.png-134.2kB"></p>
<hr>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><ul>
<li>问题<ul>
<li>(1) 找出2011年发生的所有交易，并按交易额排序（从低到高）。</li>
<li>(2) 交易员都在哪些不同的城市工作过？</li>
<li>(3) 查找所有来自于剑桥的交易员，并按姓名排序。</li>
<li>(4) 返回所有交易员的姓名字符串，按字母顺序排序。</li>
<li>(5) 有没有交易员是在米兰工作的？</li>
<li>(6) 打印生活在剑桥的交易员的所有交易额。</li>
<li>(7) 所有交易中，最高的交易额是多少？</li>
<li>(8) 找到交易额最小的交易。 </li>
</ul>
</li>
</ul>
<p><strong>Trader.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> <span class="title">Trader</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String city;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Trader</span><span class="params">(String n, String c)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = n;</span><br><span class="line">		<span class="keyword">this</span>.city = c;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCity</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.city;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCity</span><span class="params">(String newCity)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.city = newCity;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Trader:"</span>+<span class="keyword">this</span>.name + <span class="string">" in "</span> + <span class="keyword">this</span>.city;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Transaction.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Transaction</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Trader trader;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> year;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Transaction</span><span class="params">(Trader trader, <span class="keyword">int</span> year, <span class="keyword">int</span> value)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.trader = trader;</span><br><span class="line">		<span class="keyword">this</span>.year = year;</span><br><span class="line">		<span class="keyword">this</span>.value = value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Trader <span class="title">getTrader</span><span class="params">()</span></span>&#123; </span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.trader;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getYear</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.year;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">	    <span class="keyword">return</span> <span class="string">"&#123;"</span> + <span class="keyword">this</span>.trader + <span class="string">", "</span> +</span><br><span class="line">	           <span class="string">"year: "</span>+<span class="keyword">this</span>.year+<span class="string">", "</span> +</span><br><span class="line">	           <span class="string">"value:"</span> + <span class="keyword">this</span>.value +<span class="string">"&#125;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h3><ul>
<li>toSet()，这样就会把流转换为集合;</li>
<li>joining （其内部会用到StringBuilder）,会对<code>Stream&lt;String&gt;</code>进行reduce拼接．</li>
<li>流支持min和max方法，它们可以接受一个Comparator作为参数，指定计算最小或最大值时要比较哪个键值</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnswers</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">        Trader raoul = <span class="keyword">new</span> Trader(<span class="string">"Raoul"</span>, <span class="string">"Cambridge"</span>);</span><br><span class="line">        Trader mario = <span class="keyword">new</span> Trader(<span class="string">"Mario"</span>, <span class="string">"Milan"</span>);</span><br><span class="line">        Trader alan = <span class="keyword">new</span> Trader(<span class="string">"Alan"</span>, <span class="string">"Cambridge"</span>);</span><br><span class="line">        Trader brian = <span class="keyword">new</span> Trader(<span class="string">"Brian"</span>, <span class="string">"Cambridge"</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Transaction&gt; transactions = Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> Transaction(brian, <span class="number">2011</span>, <span class="number">300</span>),</span><br><span class="line">                <span class="keyword">new</span> Transaction(raoul, <span class="number">2012</span>, <span class="number">1000</span>),</span><br><span class="line">                <span class="keyword">new</span> Transaction(raoul, <span class="number">2011</span>, <span class="number">400</span>),</span><br><span class="line">                <span class="keyword">new</span> Transaction(mario, <span class="number">2012</span>, <span class="number">710</span>),</span><br><span class="line">                <span class="keyword">new</span> Transaction(mario, <span class="number">2012</span>, <span class="number">700</span>),</span><br><span class="line">                <span class="keyword">new</span> Transaction(alan, <span class="number">2012</span>, <span class="number">950</span>)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 找出2011年的所有交易并按交易额排序（从低到高）</span></span><br><span class="line">        List&lt;Transaction&gt; transactionList = transactions.stream()</span><br><span class="line">                .filter(t -&gt; t.getYear() == <span class="number">2011</span>)</span><br><span class="line">                .sorted(comparing(Transaction::getValue))</span><br><span class="line">                .collect(toList());</span><br><span class="line">        System.out.println(transactionList);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 交易员都在哪些不同的城市工作过</span></span><br><span class="line">        List&lt;String&gt; cities = transactions.stream()</span><br><span class="line">                .map(t -&gt; t.getTrader())</span><br><span class="line">                .map(trader -&gt; trader.getCity()) <span class="comment">// 两个可以合并为一个.</span></span><br><span class="line">                .distinct()</span><br><span class="line">                .collect(toList()); <span class="comment">// toSet()更简洁, 去掉distinct()方法．</span></span><br><span class="line">        System.out.println(cities);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//　查找所有来自于剑桥的交易员，并按姓名排序</span></span><br><span class="line">        List&lt;Trader&gt; traders = transactions.stream()</span><br><span class="line">                .map(transaction -&gt; transaction.getTrader()) <span class="comment">// map(Transaction::getTrader)</span></span><br><span class="line">                .filter(trander -&gt; trander.getCity().equals(<span class="string">"Cambridge"</span>))</span><br><span class="line">                .distinct()</span><br><span class="line">                .sorted(comparing(Trader::getName))</span><br><span class="line">                .collect(toList());</span><br><span class="line"></span><br><span class="line">        System.out.println(traders);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回所有交易员的姓名字符串，按字母顺序排序</span></span><br><span class="line">        String nameString = transactions.stream()</span><br><span class="line">                .map(transaction -&gt; transaction.getTrader().getName())</span><br><span class="line">                .distinct()</span><br><span class="line">                .sorted()</span><br><span class="line">                .reduce(<span class="string">""</span>, (a, b) -&gt; a + b);<span class="comment">// collect(joining()); better.</span></span><br><span class="line">        System.out.println(nameString);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 有没有交易员是在米兰工作的</span></span><br><span class="line">        <span class="keyword">boolean</span> anyMilan = transactions.stream()</span><br><span class="line">                .anyMatch(transaction -&gt; transaction.getTrader().getCity().equals(<span class="string">"Milan"</span>));</span><br><span class="line">        System.out.println(anyMilan);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印生活在剑桥的每个交易员的交易额</span></span><br><span class="line">        transactions.stream()</span><br><span class="line">                .filter(transaction -&gt; transaction.getTrader().getCity().equals(<span class="string">"Cambridge"</span>))</span><br><span class="line">                .map(transaction -&gt; transaction.getValue()) <span class="comment">// map(Transaction::getValue)</span></span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 所有交易中，最高的交易额是多少</span></span><br><span class="line">        Optional&lt;Integer&gt; maxValue = transactions.stream()</span><br><span class="line">                .map(transaction -&gt; transaction.getValue()) <span class="comment">// 等价于 map(Transaction::getValue)</span></span><br><span class="line">                .reduce(Integer::max);</span><br><span class="line">        maxValue.ifPresent(System.out::println);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 找到交易额最小的交易</span></span><br><span class="line">        transactions.stream()</span><br><span class="line">                .reduce((t1, t2) -&gt; (t1.getValue() &lt; t2.getValue()) ? t1 : t2);</span><br><span class="line">        <span class="comment">// 等价于</span></span><br><span class="line">        transactions.stream()</span><br><span class="line">                .min(comparing(Transaction::getValue));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="数值流"><a href="#数值流" class="headerlink" title="数值流"></a>数值流</h2><ul>
<li>Stream API还提供了原始类型流特化，专门支持处理数值流的方法。</li>
<li>Java 8引入了三个原始类型特化流接口：<code>IntStream</code>、<code>DoubleStream</code>和<code>LongStream</code>，分别将流中的元素特化为int、 long和double，从而避免了暗含的装箱成本。每个接口都带来了进行常用数值归约的新方法，比如对数值流求和的sum，找到最大元素的max。此外还有在必要时再把它们转换回对象流的方法。这些特化的原因并不在于流的复杂性，而是装箱造成的复杂性</li>
</ul>
<p><strong>IntStream.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IntStream</span> <span class="keyword">extends</span> <span class="title">BaseStream</span>&lt;<span class="title">Integer</span>, <span class="title">IntStream</span>&gt; </span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="function">IntStream <span class="title">filter</span><span class="params">(IntPredicate predicate)</span></span>;</span><br><span class="line">    <span class="function">IntStream <span class="title">map</span><span class="params">(IntUnaryOperator mapper)</span></span>;</span><br><span class="line">    &lt;U&gt; <span class="function">Stream&lt;U&gt; <span class="title">mapToObj</span><span class="params">(IntFunction&lt;? extends U&gt; mapper)</span></span>;</span><br><span class="line">    <span class="comment">// maptoXXX()</span></span><br><span class="line">    <span class="function">IntStream <span class="title">flatMap</span><span class="params">(IntFunction&lt;? extends IntStream&gt; mapper)</span></span>;</span><br><span class="line">    <span class="function">IntStream <span class="title">distinct</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">IntStream <span class="title">sorted</span><span class="params">()</span></span>; <span class="comment">// Returns a stream consisting of the elements of this stream in sorted order.</span></span><br><span class="line">    <span class="function">IntStream <span class="title">peek</span><span class="params">(IntConsumer action)</span></span>;</span><br><span class="line">    <span class="function">IntStream <span class="title">limit</span><span class="params">(<span class="keyword">long</span> maxSize)</span></span>;</span><br><span class="line">    <span class="function">IntStream <span class="title">skip</span><span class="params">(<span class="keyword">long</span> n)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">forEach</span><span class="params">(IntConsumer action)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">forEachOrdered</span><span class="params">(IntConsumer action)</span></span>;</span><br><span class="line">    <span class="keyword">int</span>[] toArray();</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">reduce</span><span class="params">(<span class="keyword">int</span> identity, IntBinaryOperator op)</span></span>;</span><br><span class="line">    &lt;R&gt; <span class="function">R <span class="title">collect</span><span class="params">(Supplier&lt;R&gt; supplier,</span></span></span><br><span class="line"><span class="function"><span class="params">                  ObjIntConsumer&lt;R&gt; accumulator,</span></span></span><br><span class="line"><span class="function"><span class="params">                  BiConsumer&lt;R, R&gt; combiner)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">OptionalInt <span class="title">min</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">OptionalInt <span class="title">max</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">count</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">OptionalDouble <span class="title">average</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">IntSummaryStatistics <span class="title">summaryStatistics</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">anyMatch</span><span class="params">(IntPredicate predicate)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">allMatch</span><span class="params">(IntPredicate predicate)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">noneMatch</span><span class="params">(IntPredicate predicate)</span></span>;</span><br><span class="line">    <span class="function">OptionalInt <span class="title">findFirst</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">OptionalInt <span class="title">findAny</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">LongStream <span class="title">asLongStream</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">DoubleStream <span class="title">asDoubleStream</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Stream&lt;Integer&gt; <span class="title">boxed</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">IntStream <span class="title">sequential</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">IntStream <span class="title">parallel</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    PrimitiveIterator.<span class="function">OfInt <span class="title">iterator</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Spliterator.<span class="function">OfInt <span class="title">spliterator</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IntStream <span class="title">empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> StreamSupport.intStream(Spliterators.emptyIntSpliterator(), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IntStream <span class="title">of</span><span class="params">(<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> StreamSupport.intStream(<span class="keyword">new</span> Streams.IntStreamBuilderImpl(t), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IntStream <span class="title">of</span><span class="params">(<span class="keyword">int</span>... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(values);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an infinite sequential ordered &#123;<span class="doctag">@code</span> IntStream&#125; produced by iterative</span></span><br><span class="line"><span class="comment">     * application of a function &#123;<span class="doctag">@code</span> f&#125; to an initial element &#123;<span class="doctag">@code</span> seed&#125;,</span></span><br><span class="line"><span class="comment">     * producing a &#123;<span class="doctag">@code</span> Stream&#125; consisting of &#123;<span class="doctag">@code</span> seed&#125;, &#123;<span class="doctag">@code</span> f(seed)&#125;,</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> f(f(seed))&#125;, etc.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IntStream <span class="title">iterate</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> seed, <span class="keyword">final</span> IntUnaryOperator f)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(f);</span><br><span class="line">        <span class="keyword">final</span> PrimitiveIterator.OfInt iterator = <span class="keyword">new</span> PrimitiveIterator.OfInt() &#123;</span><br><span class="line">            <span class="keyword">int</span> t = seed;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">nextInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> v = t;</span><br><span class="line">                t = f.applyAsInt(t);</span><br><span class="line">                <span class="keyword">return</span> v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> StreamSupport.intStream(Spliterators.spliteratorUnknownSize(</span><br><span class="line">                iterator,</span><br><span class="line">                Spliterator.ORDERED | Spliterator.IMMUTABLE | Spliterator.NONNULL), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns an infinite sequential unordered stream where each element is</span></span><br><span class="line"><span class="comment">     * generated by the provided &#123;<span class="doctag">@code</span> IntSupplier&#125;.  This is suitable for</span></span><br><span class="line"><span class="comment">     * generating constant streams, streams of random elements, etc.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IntStream <span class="title">generate</span><span class="params">(IntSupplier s)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(s);</span><br><span class="line">        <span class="keyword">return</span> StreamSupport.intStream(</span><br><span class="line">                <span class="keyword">new</span> StreamSpliterators.InfiniteSupplyingSpliterator.OfInt(Long.MAX_VALUE, s), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a sequential ordered &#123;<span class="doctag">@code</span> IntStream&#125; from &#123;<span class="doctag">@code</span> startInclusive&#125;</span></span><br><span class="line"><span class="comment">     * (inclusive) to &#123;<span class="doctag">@code</span> endExclusive&#125; (exclusive) by an incremental step of</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> 1&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IntStream <span class="title">range</span><span class="params">(<span class="keyword">int</span> startInclusive, <span class="keyword">int</span> endExclusive)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (startInclusive &gt;= endExclusive) &#123;</span><br><span class="line">            <span class="keyword">return</span> empty();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> StreamSupport.intStream(</span><br><span class="line">                    <span class="keyword">new</span> Streams.RangeIntSpliterator(startInclusive, endExclusive, <span class="keyword">false</span>), <span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a sequential ordered &#123;<span class="doctag">@code</span> IntStream&#125; from &#123;<span class="doctag">@code</span> startInclusive&#125;</span></span><br><span class="line"><span class="comment">     * (inclusive) to &#123;<span class="doctag">@code</span> endInclusive&#125; (inclusive) by an incremental step of</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> 1&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IntStream <span class="title">rangeClosed</span><span class="params">(<span class="keyword">int</span> startInclusive, <span class="keyword">int</span> endInclusive)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (startInclusive &gt; endInclusive) &#123;</span><br><span class="line">            <span class="keyword">return</span> empty();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> StreamSupport.intStream(</span><br><span class="line">                    <span class="keyword">new</span> Streams.RangeIntSpliterator(startInclusive, endInclusive, <span class="keyword">true</span>), <span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a lazily concatenated stream whose elements are all the</span></span><br><span class="line"><span class="comment">     * elements of the first stream followed by all the elements of the</span></span><br><span class="line"><span class="comment">     * second stream.  The resulting stream is ordered if both</span></span><br><span class="line"><span class="comment">     * of the input streams are ordered, and parallel if either of the input</span></span><br><span class="line"><span class="comment">     * streams is parallel.  When the resulting stream is closed, the close</span></span><br><span class="line"><span class="comment">     * handlers for both input streams are invoked.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IntStream <span class="title">concat</span><span class="params">(IntStream a, IntStream b)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(a);</span><br><span class="line">        Objects.requireNonNull(b);</span><br><span class="line"></span><br><span class="line">        Spliterator.OfInt split = <span class="keyword">new</span> Streams.ConcatSpliterator.OfInt(</span><br><span class="line">                a.spliterator(), b.spliterator());</span><br><span class="line">        IntStream stream = StreamSupport.intStream(split, a.isParallel() || b.isParallel());</span><br><span class="line">        <span class="keyword">return</span> stream.onClose(Streams.composedClose(a, b));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="映射到数值流"><a href="#映射到数值流" class="headerlink" title="映射到数值流"></a>映射到数值流</h3><ul>
<li>将流转换为特化版本的常用方法是mapToInt、mapToDouble和mapToLong。这些方法和前面说的map方法的工作方式一样，只是它们返回的是一个特化流，而不是Stream<t></t></li>
<li>如果流是空的， sum默认返回0</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> calories = menu.stream() <span class="comment">// Stream&lt;Dish&gt;</span></span><br><span class="line">    .mapToInt(Dish::getCalories) <span class="comment">// IntStream</span></span><br><span class="line">    .sum();</span><br></pre></td></tr></table></figure>
<h3 id="转换回对象流"><a href="#转换回对象流" class="headerlink" title="转换回对象流"></a>转换回对象流</h3><ul>
<li>要把原始流转换成一般流（每个int都会装箱成一个Integer），可以使用boxed方法；<code>IntStream -&gt; Stream&lt;Integer&gt;</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IntStream intStream = menu.stream().mapToInt(Dish::getCalories);</span><br><span class="line">Stream&lt;Integer&gt; stream = intStream.boxed();</span><br></pre></td></tr></table></figure>
<h3 id="默认值OptionalInt"><a href="#默认值OptionalInt" class="headerlink" title="默认值OptionalInt"></a>默认值OptionalInt</h3><ul>
<li>Optional类，这是一个可以表示值存在或不存在的容器。Optional可以用Integer、String等参考类型来参数化。对于三种原始流特化，也分别有一个Optional原始类型特化版本：OptionalInt、OptionalDouble和OptionalLong。</li>
<li>要找到IntStream中的最大元素，可以调用max方法，它会返回一个OptionalInt</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OptionalInt maxCalories = menu.stream()</span><br><span class="line">    .mapToInt(Dish::getCalories)　<span class="comment">// IntStream</span></span><br><span class="line">    .max();</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> max = maxCalories.orElse(<span class="number">1</span>); <span class="comment">// 显示定义一个默认值</span></span><br></pre></td></tr></table></figure>
<h3 id="数值范围"><a href="#数值范围" class="headerlink" title="数值范围"></a>数值范围</h3><ul>
<li>Java 8引入了两个可以用于IntStream和LongStream的静态方法，帮助生成这种范围：<strong>range和rangeClosed</strong>。这两个方法都是第一个参数接受起始值，第二个参数接受结束值。但range是不包含结束值的，而rangeClosed则包含结束值。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// numeric ranges</span></span><br><span class="line">IntStream evenNumbers = IntStream.rangeClosed(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">                         .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(evenNumbers.count()); <span class="comment">// 50</span></span><br></pre></td></tr></table></figure>
<h3 id="勾股数"><a href="#勾股数" class="headerlink" title="勾股数"></a>勾股数</h3><ul>
<li>三元数(a, b, c)满足公式a <em> a + b </em> b = c * c，其中a、 b、 c都是整数</li>
<li>使用具有三个元素的int数组，比如<code>new int[]{3,4,5}</code>，来表示勾股数(3,4,5)；也可以定义一个包含三个域的类表示勾股数．</li>
<li>要测试a <em> a + b </em> b的平方根是不是整数，也就是说它没有小数部分 – <strong>在Java里可以使用expr % 1表示</strong>。</li>
<li>如果没有boxed(), 会抛出如下异常: </li>
<li>如下的解决方案基本就是<strong>生成数对</strong>（number-pairs）的套路．</li>
</ul>
<blockquote>
<p>Error:(49, 29) java: 不兼容的类型: lambda 表达式中的返回类型错误<br>        不存在类型变量R的实例, 以使java.util.stream.Stream<r>与java.util.stream.IntStream一致</r></p>
</blockquote>
<p><strong>implementation-1</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;<span class="keyword">int</span>[]&gt; pythagoreanTriples =  IntStream.rangeClosed(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">                .boxed()</span><br><span class="line">                <span class="comment">// 多个Stream&lt;Integer[]&gt;扁平化为一个Stream&lt;Integer[]&gt;</span></span><br><span class="line">                .flatMap(a -&gt; IntStream.rangeClosed(a, <span class="number">100</span>) </span><br><span class="line">                        .filter(b -&gt; Math.sqrt(a*a + b*b) % <span class="number">1</span> == <span class="number">0</span>) <span class="comment">//IntStream</span></span><br><span class="line">                        .boxed() <span class="comment">// Stream&lt;Integer&gt;</span></span><br><span class="line">                        .map(b -&gt; <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;a, b, (<span class="keyword">int</span>) Math.sqrt(a * a + b * b)&#125;)); <span class="comment">// 多个Stream&lt;Integer[]&gt;      </span></span><br><span class="line"></span><br><span class="line">        pythagoreanTriples.forEach(t -&gt; System.out.println(t[<span class="number">0</span>] + <span class="string">", "</span> + t[<span class="number">1</span>] + <span class="string">", "</span> + t[<span class="number">2</span>]));</span><br></pre></td></tr></table></figure>
<p><strong>implementation-2</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;int[]&gt; triples = IntStream.rangeClosed(1, 100)</span><br><span class="line">                .boxed()</span><br><span class="line">                .flatMap(a -&gt; IntStream.rangeClosed(a, 100)</span><br><span class="line">                        .filter(b -&gt; Math.sqrt(a * a + b * b) % 1 == 0) // 仍然得到的是IntStream</span><br><span class="line">                        .mapToObj(b -&gt; new int[]&#123;a, b, (int) Math.sqrt(a * a + b * b)&#125;));// IntStream的mapToObj方法来改写它, 来得到一个Stream&lt;int[]&gt;流</span><br><span class="line">        System.out.println(&quot;-----------&quot;);</span><br><span class="line"></span><br><span class="line">        triples.forEach(t -&gt; System.out.println(t[0] + &quot;, &quot; + t[1] + &quot;, &quot; + t[2]));</span><br></pre></td></tr></table></figure>
<p><strong>implementation-3</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;<span class="keyword">double</span>[]&gt; triples2 = IntStream.rangeClosed(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">                .boxed()</span><br><span class="line">                .flatMap(a -&gt; IntStream.rangeClosed(a, <span class="number">100</span>)</span><br><span class="line">                        .mapToObj(b -&gt; <span class="keyword">new</span> <span class="keyword">double</span>[]&#123;a, b, Math.sqrt(a * a + b * b)&#125;) <span class="comment">// 先映射出所有的可能组合</span></span><br><span class="line">                        .filter(array -&gt; array[<span class="number">2</span>] % <span class="number">1</span> == <span class="number">0</span>)); <span class="comment">// 然后进行过滤</span></span><br><span class="line">        System.out.println(<span class="string">"-----"</span>);</span><br><span class="line">        triples2.forEach(t -&gt; System.out.println((<span class="keyword">int</span>) t[<span class="number">0</span>] + <span class="string">", "</span> + (<span class="keyword">int</span>) t[<span class="number">1</span>] + <span class="string">", "</span> + (<span class="keyword">int</span>) t[<span class="number">2</span>]));</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="构建流"><a href="#构建流" class="headerlink" title="构建流"></a>构建流</h2><ul>
<li>从值序列、数组、文件来创建流，甚至由生成函数来创建无限流！</li>
</ul>
<h3 id="由值创建流"><a href="#由值创建流" class="headerlink" title="由值创建流"></a>由值创建流</h3><ul>
<li>静态方法Stream.of，通过显式值创建一个流。它可以接受任意数量的参数。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Stream.of</span></span><br><span class="line">Stream&lt;String&gt; stream = Stream.of(<span class="string">"Java 8"</span>, <span class="string">"Lambdas"</span>, <span class="string">"In"</span>, <span class="string">"Action"</span>);</span><br><span class="line">stream.map(String::toUpperCase).forEach(System.out::println); <span class="comment">// 映射为大写, 然后输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 空流</span></span><br><span class="line"><span class="comment">// Stream.empty</span></span><br><span class="line">Stream&lt;String&gt; emptyStream = Stream.empty();</span><br></pre></td></tr></table></figure>
<h3 id="由数组创建流"><a href="#由数组创建流" class="headerlink" title="由数组创建流"></a>由数组创建流</h3><ul>
<li>静态方法Arrays.stream从数组创建一个流。它接受一个数组作为参数。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Arrays.stream</span></span><br><span class="line"><span class="keyword">int</span>[] numbers = &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;;</span><br><span class="line"><span class="comment">// 原始类型int的数组转换成一个IntStream</span></span><br><span class="line">System.out.println(Arrays.stream(numbers).sum());</span><br></pre></td></tr></table></figure>
<h3 id="由文件生成流"><a href="#由文件生成流" class="headerlink" title="由文件生成流"></a>由文件生成流</h3><ul>
<li>java.nio.file.Files中的很多静态方法都会返回一个流。例如，一个很有用的方法是Files.lines，它会返回一个由指定文件中的各行构成的字符串流。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> uniqueWords = Files.lines(Paths.get(<span class="string">"data.txt"</span>), Charset.defaultCharset())</span><br><span class="line">                 .flatMap(line -&gt; Arrays.stream(line.split(<span class="string">" "</span>))) <span class="comment">// line : Stream&lt;String[]&gt; , 然后多个String&lt;String[]&gt; -&gt; 单个Stream&lt;String[]&gt;</span></span><br><span class="line">                 .distinct()</span><br><span class="line">                 .count();</span><br></pre></td></tr></table></figure>
<h3 id="由函数生成流：创建无限流"><a href="#由函数生成流：创建无限流" class="headerlink" title="由函数生成流：创建无限流"></a>由函数生成流：创建无限流</h3><ul>
<li>Stream API提供了两个静态方法来从函数生成流：Stream.iterate和Stream.generate。这两个操作可以创建无限流. 由iterate和generate产生的流会用给定的函数<strong>按需创建值</strong>，应该使用<strong>limit(n)</strong>来对这种流加以限制，以避免打印无穷多个值。</li>
</ul>
<h4 id="iterate"><a href="#iterate" class="headerlink" title="iterate"></a>iterate</h4><ul>
<li>iterate方法接受一个<strong>初始值</strong>（在这里是0），还有一个<strong>依次应用在每个产生的新值上的Lambda</strong>（UnaryOperator<t>类型）。</t></li>
<li>在需要依次生成一系列值的时候应该使用iterate</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 接收的Lambda是UnaryOperator&lt;t&gt;类型，描述符是　T-&gt;T</span><br><span class="line">Stream.iterate(0, n -&gt; n + 2)</span><br><span class="line">    .limit(10)</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line">    </span><br><span class="line">// Fabnacci 数对</span><br><span class="line">Stream.iterate(new int[]&#123;0, 1&#125;, t -&gt; new int[]&#123;t[1], t[0]+t[1]&#125;)</span><br><span class="line">        .limit(20)</span><br><span class="line">        .forEach(t -&gt; System.out.println(&quot;(&quot; + t[0] + &quot;,&quot; + t[1] +&quot;)&quot;));</span><br><span class="line"></span><br><span class="line">// Fabnacci 数列，提取第一个元素即可</span><br><span class="line">Stream.iterate(new int[]&#123;0, 1&#125;, t -&gt; new int[]&#123;t[1],t[0] + t[1]&#125;)</span><br><span class="line">        .limit(10)</span><br><span class="line">        .map(t -&gt; t[0])</span><br><span class="line">        .forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<h4 id="generate"><a href="#generate" class="headerlink" title="generate"></a>generate</h4><ul>
<li>generate方法也可让你按需生成一个无限流。但generate不是依次对每个新生成的值应用函数的。它接受一个<strong>Supplier<t>类型的Lambda提供新的值</t></strong>。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// random stream of doubles with Stream.generate</span></span><br><span class="line">Stream.generate(Math::random) <span class="comment">// Math.Random静态方法被用作新值生成器</span></span><br><span class="line">      .limit(<span class="number">10</span>)</span><br><span class="line">      .forEach(System.out::println);</span><br><span class="line">      </span><br><span class="line"><span class="comment">// supplier.</span></span><br><span class="line">IntSupplier fib = <span class="keyword">new</span> IntSupplier()&#123;</span><br><span class="line">          <span class="keyword">private</span> <span class="keyword">int</span> previous = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">private</span> <span class="keyword">int</span> current = <span class="number">1</span>;</span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAsInt</span><span class="params">()</span></span>&#123;</span><br><span class="line">              <span class="keyword">int</span> nextValue = <span class="keyword">this</span>.previous + <span class="keyword">this</span>.current;</span><br><span class="line">              <span class="keyword">this</span>.previous = <span class="keyword">this</span>.current;</span><br><span class="line">              <span class="keyword">this</span>.current = nextValue;</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">this</span>.previous;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"> IntStream.generate(fib).limit(<span class="number">10</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>可以使用filter、 distinct、 skip和limit对流做筛选和切片。</li>
<li>可以使用map和flatMap提取或转换流中的元素。</li>
<li>可 以 使 用 findFirst 和 findAny 方 法 查 找 流 中 的 元 素 。 你 可 以 用 allMatch 、noneMatch和anyMatch方法让流匹配给定的谓词。</li>
<li>这些方法都利用了<strong>短路</strong>：找到结果就立即停止计算；没有必要处理整个流。</li>
<li>可以利用<strong>reduce方法将流中所有的元素迭代合并成一个结果</strong>，例如求和或查找最大元素。</li>
<li>filter和map等操作是无状态的，它们并不存储任何状态。reduce等操作要存储状态才能计算出一个值。 sorted和distinct等操作也要存储状态，因为它们需要把流中的所有元素缓存起来才能返回一个新的流。这种操作称为有状态操作。</li>
<li>流有三种基本的<strong>原始类型特化</strong>：IntStream、DoubleStream和LongStream。它们的操作也有相应的特化。</li>
<li>流不仅可以从集合创建，也可<strong>从值、数组、文件以及iterate与generate等特定方法创</strong>建。</li>
<li>无限流是没有固定大小的流。</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/Java8/" rel="tag"># Java8</a>
          
            <a href="/tags/函数式编程/" rel="tag"># 函数式编程</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/26/java8-stream-introductions/" rel="next" title="Java8-Stream简介">
                <i class="fa fa-chevron-left"></i> Java8-Stream简介
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/07/26/java8-stream-collectors/" rel="prev" title="Java8-流收集数据">
                Java8-流收集数据 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/self.jpg"
                alt="darcy" />
            
              <p class="site-author-name" itemprop="name">darcy</p>
              <p class="site-description motion-element" itemprop="description">Do Have Patience In What You LOVE.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">53</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="http://douban.com/people/70670266" target="_blank" title="douban">
                      
                        <i class="fa fa-fw fa-globe"></i>douban</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友链
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.zhenlanghuo.top/" title="zhenlang huo" target="_blank">zhenlang huo</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://xawei.me/" title="xinan wei" target="_blank">xinan wei</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#筛选和切片"><span class="nav-number">1.</span> <span class="nav-text">筛选和切片</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#谓词筛选"><span class="nav-number">1.1.</span> <span class="nav-text">谓词筛选</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#筛选各异的元素"><span class="nav-number">1.2.</span> <span class="nav-text">筛选各异的元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#截断流"><span class="nav-number">1.3.</span> <span class="nav-text">截断流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#跳过元素"><span class="nav-number">1.4.</span> <span class="nav-text">跳过元素</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#映射"><span class="nav-number">2.</span> <span class="nav-text">映射</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#对流中每一个元素应用函数"><span class="nav-number">2.1.</span> <span class="nav-text">对流中每一个元素应用函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#流的扁平化"><span class="nav-number">2.2.</span> <span class="nav-text">流的扁平化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查找和匹配"><span class="nav-number">3.</span> <span class="nav-text">查找和匹配</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#检查谓词是否至少匹配一个元素"><span class="nav-number">3.1.</span> <span class="nav-text">检查谓词是否至少匹配一个元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检查谓词是否匹配所有元素"><span class="nav-number">3.2.</span> <span class="nav-text">检查谓词是否匹配所有元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查找元素"><span class="nav-number">3.3.</span> <span class="nav-text">查找元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Optional简介"><span class="nav-number">3.4.</span> <span class="nav-text">Optional简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查找第一个元素"><span class="nav-number">3.5.</span> <span class="nav-text">查找第一个元素</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#归约"><span class="nav-number">4.</span> <span class="nav-text">归约</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#元素求和"><span class="nav-number">4.1.</span> <span class="nav-text">元素求和</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#最大值和最小值"><span class="nav-number">4.2.</span> <span class="nav-text">最大值和最小值</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#中间操作和终端操作汇总"><span class="nav-number">5.</span> <span class="nav-text">中间操作和终端操作汇总</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实践"><span class="nav-number">6.</span> <span class="nav-text">实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#解答"><span class="nav-number">6.1.</span> <span class="nav-text">解答</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数值流"><span class="nav-number">7.</span> <span class="nav-text">数值流</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#映射到数值流"><span class="nav-number">7.1.</span> <span class="nav-text">映射到数值流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#转换回对象流"><span class="nav-number">7.2.</span> <span class="nav-text">转换回对象流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#默认值OptionalInt"><span class="nav-number">7.3.</span> <span class="nav-text">默认值OptionalInt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数值范围"><span class="nav-number">7.4.</span> <span class="nav-text">数值范围</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#勾股数"><span class="nav-number">7.5.</span> <span class="nav-text">勾股数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#构建流"><span class="nav-number">8.</span> <span class="nav-text">构建流</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#由值创建流"><span class="nav-number">8.1.</span> <span class="nav-text">由值创建流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#由数组创建流"><span class="nav-number">8.2.</span> <span class="nav-text">由数组创建流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#由文件生成流"><span class="nav-number">8.3.</span> <span class="nav-text">由文件生成流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#由函数生成流：创建无限流"><span class="nav-number">8.4.</span> <span class="nav-text">由函数生成流：创建无限流</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#iterate"><span class="nav-number">8.4.1.</span> <span class="nav-text">iterate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#generate"><span class="nav-number">8.4.2.</span> <span class="nav-text">generate</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">9.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">darcy</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count"></span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("nDVrc1Rvjlwx4V9XScsLSm9q-gzGzoHsz", "4ONqgToWREwRHxcX9qRXFhlL");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
